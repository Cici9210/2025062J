# 功能測試檢查清單

## 🔧 已修復問題

### 修復內容
1. **API 配置更新**: 將前端 API URL 從 `172.20.10.2` 更新為 `192.168.1.114`
2. **服務重啟**: 前後端服務已重新啟動並載入最新配置

### 當前服務狀態
- ✅ **後端服務**: Port 8000 (PID: 14912)
- ✅ **前端服務**: Port 8080 (PID: 47484)
- ✅ **測試網址**: http://192.168.1.114:8080

---

## 📱 測試流程

### 準備工作
1. **測試帳號**:
   - 帳號A: tester_a@example.com (User ID: 19)
   - 帳號B: tester_b@example.com (User ID: 20)
   - 密碼: Test123!

2. **測試環境**:
   - 建議使用兩台設備(電腦 + iPhone)或兩個瀏覽器分頁
   - 確保設備連接到相同的 WiFi 網絡 (192.168.1.x)

---

## ✅ 測試項目

### 1. 好友列表功能測試

**步驟**:
1. 登入帳號A (tester_a@example.com)
2. 點擊底部導航欄的「好友」標籤
3. 檢查好友列表是否正常載入

**預期結果**:
- ✅ 能看到好友列表畫面
- ✅ 如果有好友,應該顯示好友卡片
- ✅ 如果沒有好友,應該顯示空狀態提示
- ✅ 右上角有聊天氣泡圖標按鈕
- ✅ 右下角有粉紅色「開始配對」浮動按鈕

**可能問題**:
- ❌ 如果顯示錯誤訊息,請檢查控制台錯誤
- ❌ 如果一直載入中,請檢查網絡連接

---

### 2. 聊天室列表功能測試

**步驟**:
1. 在好友列表畫面
2. 點擊右上角的聊天氣泡圖標
3. 檢查聊天室列表畫面

**預期結果**:
- ✅ 能進入聊天室列表畫面
- ✅ 如果有聊天室,應該顯示聊天室卡片
  - 藍色卡片 = 臨時聊天室(帶倒數計時)
  - 紫色卡片 = 永久聊天室(好友)
- ✅ 臨時聊天室顯示剩餘時間倒數
- ✅ 如果沒有聊天室,顯示空狀態提示
- ✅ 下拉可以刷新列表

**可能問題**:
- ❌ 如果顯示 404 錯誤,API 路由可能有問題
- ❌ 如果倒數計時不更新,Timer 可能有問題

---

### 3. 配對功能測試

**步驟**:
1. 帳號A: 點擊「開始配對」按鈕
2. 輸入對方 User ID: 20 (帳號B的ID)
3. 點擊「開始配對」
4. 等待配對結果

**預期結果**:
- ✅ 顯示配對成功卡片
- ✅ 卡片顯示:
  - ✅ 配對成功訊息
  - ✅ 對方電子郵件
  - ✅ 5分鐘倒數計時器
  - ✅ 「進入聊天室」按鈕
- ✅ 點擊「進入聊天室」能跳轉到訊息畫面

**可能問題**:
- ❌ 如果配對失敗,檢查是否:
  - User ID 是否正確(必須是數字)
  - 對方帳號是否存在
  - 網絡連接是否正常

---

### 4. 臨時聊天室功能測試

**步驟**:
1. 完成配對後,進入聊天室
2. 發送幾條訊息
3. 返回聊天室列表
4. 檢查臨時聊天室卡片

**預期結果**:
- ✅ 在聊天室列表看到新的藍色卡片(臨時聊天室)
- ✅ 卡片顯示:
  - 💙 藍色背景
  - ⏱ 臨時聊天室標誌
  - 對方電子郵件
  - 剩餘時間倒數(每秒更新)
- ✅ 倒數計時自動更新
- ✅ 點擊卡片能進入聊天畫面

---

### 5. 聊天室過期測試 (快速測試)

**測試方式A - 等待5分鐘**:
1. 創建配對後等待5分鐘
2. 系統自動檢測過期
3. 彈出好友邀請對話框

**測試方式B - 後端手動觸發**:
由於等待5分鐘太久,可以手動觸發:

```powershell
# 在 PowerShell 中執行(需要先取得聊天室ID和認證token)
$chatRoomId = 1  # 替換為實際的聊天室ID
$token = "your_auth_token_here"  # 替換為實際的token

curl -X POST "http://localhost:8000/api/pairing/chat-room/$chatRoomId/check-expiry" `
  -H "Authorization: Bearer $token"
```

**預期結果**:
- ✅ 自動彈出粉紅色邀請對話框
- ✅ 對話框顯示:
  - 💌 郵件圖標
  - 「好友邀請」標題
  - 對方電子郵件
  - 邀請訊息
  - 「接受」按鈕(白色)
  - 「拒絕」按鈕(半透明)
- ✅ 對話框無法通過點擊外部關閉

---

### 6. 好友邀請回應測試

**步驟**:
1. 帳號A: 在邀請對話框點擊「接受」
2. 帳號B: 也需要登入並接受邀請
3. 雙方都接受後,檢查結果

**預期結果**:
- ✅ 點擊「接受」後顯示處理動畫
- ✅ 顯示成功訊息 SnackBar
- ✅ 對話框關閉
- ✅ 雙方都接受後:
  - 聊天室從臨時(藍色)變為永久(紫色)
  - 好友列表中出現對方
  - 聊天室卡片顯示「💜 好友聊天室」

**如果點擊「拒絕」**:
- ✅ 顯示拒絕訊息
- ✅ 對話框關閉
- ✅ 聊天室關閉
- ✅ 不會成為好友

---

### 7. 永久聊天室測試

**步驟**:
1. 完成好友邀請流程(雙方都接受)
2. 檢查聊天室列表
3. 檢查好友列表

**預期結果**:
- ✅ 聊天室列表中看到紫色卡片
- ✅ 卡片顯示:
  - 💜 紫色背景
  - ❤️ 好友聊天室標誌
  - 對方電子郵件
  - ✅ 已驗證好友圖標
  - **無倒數計時**(永久有效)
- ✅ 好友列表中出現對方
- ✅ 可以隨時進入聊天
- ✅ 聊天室不會過期

---

## 🐛 除錯指南

### 常見問題診斷

#### 問題1: 好友列表/聊天室列表顯示錯誤
**可能原因**:
- API 請求失敗
- 認證 token 無效
- 網絡連接問題

**檢查方式**:
1. 打開瀏覽器開發者工具(F12)
2. 切換到 Network 標籤
3. 重新載入頁面
4. 查找失敗的 API 請求(紅色)
5. 檢查請求 URL 和回應內容

**預期的 API 請求**:
- `GET http://192.168.1.114:8000/api/pairing/friends` - 獲取好友列表
- `GET http://192.168.1.114:8000/api/pairing/chat-rooms` - 獲取聊天室列表
- `GET http://192.168.1.114:8000/api/pairing/invitations` - 獲取邀請

#### 問題2: 配對失敗
**檢查項目**:
- ✅ 輸入的 User ID 是否為數字
- ✅ 對方帳號是否存在
- ✅ 是否與自己配對(不允許)
- ✅ 後端服務是否正常運行

#### 問題3: 倒數計時不更新
**可能原因**:
- Timer 沒有正確啟動
- 組件沒有重新渲染

**檢查**:
- 瀏覽器控制台是否有錯誤
- 時間格式是否正確

#### 問題4: 邀請對話框沒有彈出
**可能原因**:
- 過期檢查沒有運行
- API 回應格式不正確

**手動測試**:
```dart
// 在 chat_room_list_screen.dart 中添加測試按鈕
// 手動觸發邀請對話框
_showInvitationNotification(chatRoom);
```

---

## 📊 API 端點測試

### 使用 curl 測試後端 API

**注意**: 需要先登入獲取 token

#### 1. 獲取認證 token
```powershell
# 登入取得 token
$response = curl -X POST "http://localhost:8000/api/auth/token" `
  -H "Content-Type: application/x-www-form-urlencoded" `
  -d "username=tester_a@example.com&password=Test123!"

# 從回應中提取 token
$token = ($response | ConvertFrom-Json).access_token
echo $token
```

#### 2. 測試好友列表 API
```powershell
curl -H "Authorization: Bearer $token" `
  http://localhost:8000/api/pairing/friends
```

#### 3. 測試聊天室列表 API
```powershell
curl -H "Authorization: Bearer $token" `
  http://localhost:8000/api/pairing/chat-rooms
```

#### 4. 測試配對 API
```powershell
curl -X POST "http://localhost:8000/api/pairing/match" `
  -H "Authorization: Bearer $token" `
  -H "Content-Type: application/json" `
  -d '{"target_user_id": 20}'
```

#### 5. 測試邀請列表 API
```powershell
curl -H "Authorization: Bearer $token" `
  http://localhost:8000/api/pairing/invitations
```

---

## 📝 預期的正常行為總結

### 配對流程
1. 用戶A輸入用戶B的ID → 創建配對
2. 系統自動創建5分鐘臨時聊天室
3. 雙方可以在臨時聊天室中聊天
4. 倒數計時顯示剩餘時間
5. 5分鐘後(或手動觸發),聊天室過期
6. 自動創建好友邀請
7. 雙方收到邀請通知(對話框彈出)
8. 如果雙方都接受 → 成為好友,聊天室升級為永久
9. 如果任一方拒絕 → 聊天室關閉,不成為好友

### UI 視覺識別
- **臨時聊天室**: 藍色卡片 💙 + ⏱ + 倒數計時
- **永久聊天室**: 紫色卡片 💜 + ❤️ + ✅ 已驗證
- **配對按鈕**: 粉紅色 (#FF6B9D) + ❤️ 圖標
- **邀請對話框**: 粉紅色漸層背景 + 💌 圖標

---

## 🎯 成功標準

測試完全成功的標誌:
- ✅ 所有畫面能正常載入
- ✅ 能創建配對並進入臨時聊天
- ✅ 倒數計時每秒更新
- ✅ 聊天室列表正確顯示臨時和永久聊天室
- ✅ 過期後自動彈出邀請對話框
- ✅ 雙方接受後成為好友
- ✅ 好友聊天室永久有效
- ✅ 沒有控制台錯誤

祝測試順利! 🎉
