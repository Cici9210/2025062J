# 📱 手機安裝與操作完整指南

## 🎯 當前服務狀態

✅ **後端服務**: 運行中 (Port 8000)  
✅ **前端服務**: 運行中 (Port 8080)  
🌐 **電腦 IP 地址**: `192.168.64.12`  
📱 **手機訪問網址**: `http://192.168.64.12:8080`

---

## ⚠️ 重要前提條件

1. **手機必須與電腦連接同一個 Wi-Fi 網路**
2. **確保防火牆允許端口 8000 和 8080 的連接**
3. **後端和前端服務必須保持運行**

---

## 📲 iOS (iPhone/iPad) 安裝步驟

### 步驟 1: 打開 Safari 瀏覽器
- ⚠️ **必須使用 Safari**，Chrome 不支援添加到主畫面功能
- 在 Safari 地址欄輸入: `http://192.168.64.12:8080`

### 步驟 2: 等待頁面完全載入
- 看到 Heartbeat App 的主畫面
- 確認頁面正常顯示，沒有錯誤訊息

### 步驟 3: 添加到主畫面
1. 點擊底部工具列的 **分享按鈕** (方框帶向上箭頭圖示)
2. 向下滾動，找到 **「加入主畫面螢幕」** 或 **「Add to Home Screen」**
3. 點擊後會出現預覽畫面
4. 可以修改應用名稱 (預設為 "Heartbeat App")
5. 點擊右上角 **「加入」** 或 **「Add」**

### 步驟 4: 完成安裝
- 返回 iPhone 主畫面
- 找到新增的 **Heartbeat App** 圖示
- 點擊圖示即可啟動應用 (類似原生 App)

---

## 🤖 Android 安裝步驟

### 步驟 1: 打開 Chrome 瀏覽器
- 建議使用 Chrome 瀏覽器 (最佳支援)
- 在地址欄輸入: `http://192.168.64.12:8080`

### 步驟 2: 等待頁面載入
- 看到 Heartbeat App 的主畫面
- 確認頁面正常顯示

### 步驟 3: 添加到主畫面
1. 點擊右上角 **三點選單** (⋮)
2. 選擇 **「安裝應用程式」** 或 **「新增至主畫面」**
3. 彈出對話框確認應用名稱
4. 點擊 **「安裝」** 或 **「新增」**

### 步驟 4: 完成安裝
- 返回 Android 主畫面
- 找到新增的 **Heartbeat App** 圖示
- 點擊圖示即可啟動應用

---

## 🎮 手機主畫面操作流程

### 首次啟動 - 註冊與登入

#### 1️⃣ 註冊新帳號
```
主畫面 → 右上角「註冊」
↓
填寫註冊資訊:
  - 使用者名稱: 例如 "Alice"
  - Email: 例如 "alice@example.com"
  - 密碼: 至少 6 位
  - 確認密碼
↓
點擊「註冊」→ 自動登入
```

#### 2️⃣ 登入現有帳號
```
主畫面 → 填寫 Email 和密碼
↓
點擊「登入」→ 進入首頁
```

---

### 主要功能操作流程

#### 🎲 隨機配對功能
```
首頁 → 「隨機配對」卡片 → 點擊「開始隨機配對」
↓
進入等待畫面 (顯示動畫和等待訊息)
↓
配對成功! 顯示對方使用者名稱
↓
點擊「開始聊天」→ 進入臨時聊天室
↓
聊天室上方顯示「倒計時」(例如: 23:59:45)
  - 綠色: 剩餘時間充足
  - 橙色: 時間不多
  - 紅色: 即將結束
```

**注意事項:**
- 配對等待時間取決於是否有其他用戶在線
- 可以點擊「取消等待」離開配對隊列
- 臨時聊天室到期後會自動關閉

---

#### 👥 好友系統
```
首頁 → 「好友」標籤頁
↓
添加好友:
  1. 點擊「添加好友」
  2. 輸入對方的使用者名稱或 Email
  3. 點擊「發送好友請求」
↓
好友列表:
  - 顯示所有好友
  - 點擊好友頭像 → 查看個人資料
  - 點擊好友 → 開始聊天
```

---

#### 📱 好友裝置狀態
```
首頁 → 快速操作區 → 點擊「好友裝置狀態」
↓
查看所有好友的 ESP32 裝置:
  - 🟢 綠色: 在線中
  - 🔴 紅色: 離線
  - 顯示最後活動時間:
    * "剛剛" (1分鐘內)
    * "3分鐘前"
    * "1小時前"
    * "2天前"
↓
下拉刷新 → 更新裝置狀態
```

**自動更新:**
- 頁面每 10 秒自動刷新一次
- 無需手動操作即可看到最新狀態

---

#### 💬 聊天功能
```
選擇好友 → 點擊「發送訊息」
↓
進入聊天室:
  - 輸入文字訊息
  - 點擊「發送」
  - 即時接收對方訊息 (WebSocket)
↓
聊天記錄:
  - 自動保存所有訊息
  - 顯示時間戳記
  - 支援表情符號
```

---

#### 🔗 ESP32 裝置配對
```
首頁 → 「裝置」標籤頁 → 「添加裝置」
↓
輸入 ESP32 配對碼 (例如: "ABC123")
↓
點擊「配對」→ 裝置綁定成功
↓
裝置列表顯示:
  - 裝置名稱
  - 在線狀態
  - 電池電量 (如果支援)
  - 最後心跳時間
```

---

## 🔥 完整使用場景示範

### 場景 1: 兩個用戶隨機配對聊天

**用戶 A (Alice):**
```
1. 主畫面 → 登入
2. 點擊「隨機配對」
3. 等待配對...
4. 配對成功! (與 Bob 配對)
5. 進入聊天室 → 看到倒計時 "23:59:30"
6. 發送訊息: "Hi! 很高興認識你"
7. 持續聊天...
8. 24小時後聊天室自動關閉
```

**用戶 B (Bob):**
```
1. 主畫面 → 登入
2. 點擊「隨機配對」
3. 立即配對成功! (與 Alice 配對)
4. 進入聊天室
5. 收到 Alice 的訊息
6. 回覆: "Hi Alice! 我也很高興!"
```

---

### 場景 2: 查看好友的 ESP32 裝置狀態

**用戶 C (Carol):**
```
1. 登入後進入首頁
2. 點擊「好友裝置狀態」卡片
3. 看到好友列表:
   - 👤 Dave 的裝置 🟢 在線 (剛剛)
   - 👤 Eve 的裝置 🔴 離線 (2小時前)
4. 下拉刷新 → 更新狀態
5. 發現 Eve 上線了! 🟢 (剛剛)
```

---

## 🛠️ 故障排除

### ❌ 無法訪問網址 `http://192.168.64.12:8080`

**解決方案:**
1. ✅ 確認手機和電腦在**同一個 Wi-Fi 網路**
2. ✅ 在電腦上測試: 瀏覽器打開 `http://localhost:8080` (應該看到應用)
3. ✅ 檢查後端服務運行狀態 (port 8000)
4. ✅ 檢查前端服務運行狀態 (port 8080)
5. ✅ 檢查 Windows 防火牆設定

**防火牆設定 (如需要):**
```powershell
# 允許端口 8000 (後端)
New-NetFirewallRule -DisplayName "Heartbeat Backend" -Direction Inbound -LocalPort 8000 -Protocol TCP -Action Allow

# 允許端口 8080 (前端)
New-NetFirewallRule -DisplayName "Heartbeat Frontend" -Direction Inbound -LocalPort 8080 -Protocol Allow
```

---

### ❌ 配對一直等待，無法成功

**原因:** 配對需要至少兩個用戶同時在線

**解決方案:**
1. 使用兩台手機或一台手機 + 一台電腦瀏覽器
2. 同時點擊「開始隨機配對」
3. 等待 2-5 秒即可配對成功

---

### ❌ 聊天訊息發送失敗

**解決方案:**
1. 檢查網路連接
2. 確認後端服務運行中
3. 重新整理頁面 (下拉刷新)
4. 重新登入帳號

---

### ❌ iOS Safari 無法添加到主畫面

**解決方案:**
1. **必須使用 Safari**，不能用 Chrome
2. 確認 iOS 版本 (建議 iOS 13 以上)
3. 檢查 Safari 設定是否允許網站圖示

---

## 📊 測試用帳號 (如已建立)

如果已經執行過 `create_test_user.py`，可使用以下測試帳號:

```
帳號 A:
  Email: alice@example.com
  密碼: password123

帳號 B:
  Email: bob@example.com
  密碼: password123
```

---

## 🎉 快速啟動檢查清單

在使用前確認以下項目:

- [ ] 後端服務運行中 (`http://localhost:8000/docs` 可訪問)
- [ ] 前端服務運行中 (`http://localhost:8080` 可訪問)
- [ ] 手機與電腦連接同一 Wi-Fi
- [ ] 手機瀏覽器打開 `http://192.168.64.12:8080`
- [ ] 註冊或登入帳號成功
- [ ] 測試隨機配對功能 (需要兩個用戶)
- [ ] 測試好友裝置狀態頁面

---

## 📞 需要幫助?

如遇到問題，請檢查:
1. 電腦上的後端日誌 (PowerShell 視窗)
2. 前端服務日誌 (PowerShell 視窗)
3. 手機瀏覽器的開發者工具 (如支援)

---

**最後更新**: 2024 年 6 月  
**適用版本**: Heartbeat App v1.0  
**支援平台**: iOS 13+, Android 8+