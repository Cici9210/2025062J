# å‰ç«¯æ¸¬è©¦å¿«é€ŸæŒ‡å—

## ğŸš€ æœå‹™å·²å•Ÿå‹•

### âœ… é‹è¡Œä¸­çš„æœå‹™

1. **å¾Œç«¯APIæœå‹™**
   - åœ°å€: http://192.168.1.114:8000
   - ç‹€æ…‹: âœ“ é‹è¡Œä¸­
   - APIæ–‡æª”: http://192.168.1.114:8000/docs

2. **å‰ç«¯Webæ‡‰ç”¨**
   - åœ°å€: http://localhost:8080
   - ç‹€æ…‹: âœ“ é‹è¡Œä¸­
   - å·²åœ¨VS Code Simple Browserä¸­æ‰“é–‹

---

## ğŸ“‹ æ¸¬è©¦æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šç”¨æˆ¶è¨»å†Šå’Œç™»å…¥

1. æ‰“é–‹å‰ç«¯é é¢: http://localhost:8080
2. é»æ“Šã€Œè¨»å†Šã€æˆ–ã€ŒRegisterã€
3. å‰µå»ºå…©å€‹æ¸¬è©¦å¸³è™Ÿï¼š
   - **ç”¨æˆ¶A**: test_a@example.com / Test123!
   - **ç”¨æˆ¶B**: test_b@example.com / Test123!

### ç¬¬äºŒæ­¥ï¼šæ¸¬è©¦éš¨æ©Ÿé…å°åŠŸèƒ½

**ç”¨æˆ¶Açš„æ“ä½œ**:
1. ä½¿ç”¨ test_a@example.com ç™»å…¥
2. é€²å…¥ã€Œé…å°ã€æˆ–ã€ŒPairingã€é é¢
3. é»æ“Šã€Œéš¨æ©Ÿé…å°ã€æŒ‰éˆ•
4. ç³»çµ±é¡¯ç¤ºã€Œå·²åŠ å…¥é…å°éšŠåˆ—ï¼Œç­‰å¾…é…å°...ã€

**ç”¨æˆ¶Bçš„æ“ä½œ**:
1. é–‹å•Ÿç„¡ç—•è¦–çª—æˆ–å¦ä¸€å€‹ç€è¦½å™¨
2. è¨ªå• http://localhost:8080
3. ä½¿ç”¨ test_b@example.com ç™»å…¥
4. é€²å…¥ã€Œé…å°ã€æˆ–ã€ŒPairingã€é é¢
5. é»æ“Šã€Œéš¨æ©Ÿé…å°ã€æŒ‰éˆ•
6. ç³»çµ±é¡¯ç¤ºã€Œé…å°æˆåŠŸï¼ã€
7. è‡ªå‹•å‰µå»ºè‡¨æ™‚èŠå¤©å®¤

### ç¬¬ä¸‰æ­¥ï¼šæ¸¬è©¦è‡¨æ™‚èŠå¤©å®¤ï¼ˆ5åˆ†é˜ï¼‰

**æ¸¬è©¦æ¨¡å¼ï¼š30ç§’éæœŸ**

1. é…å°æˆåŠŸå¾Œï¼Œé›™æ–¹å¯ä»¥çœ‹åˆ°èŠå¤©å®¤
2. å˜—è©¦ç™¼é€è¨Šæ¯
3. è§€å¯Ÿå€’æ•¸è¨ˆæ™‚å™¨ï¼ˆé¡¯ç¤ºå‰©é¤˜æ™‚é–“ï¼‰
4. ç­‰å¾…30ç§’ï¼ˆæ¸¬è©¦æ¨¡å¼ï¼‰æˆ–5åˆ†é˜ï¼ˆç”Ÿç”¢æ¨¡å¼ï¼‰
5. èŠå¤©å®¤éæœŸå¾Œæœƒå‡ºç¾ã€Œå¥½å‹é‚€è«‹ã€é€šçŸ¥

### ç¬¬å››æ­¥ï¼šæ¸¬è©¦å¥½å‹é‚€è«‹åŠŸèƒ½

**ç•¶è‡¨æ™‚èŠå¤©å®¤éæœŸå¾Œ**:

1. é›™æ–¹éƒ½æœƒæ”¶åˆ°ã€Œå¥½å‹é‚€è«‹ã€é€šçŸ¥
2. ç”¨æˆ¶Aé»æ“Šã€Œæ¥å—ã€é‚€è«‹
3. ç”¨æˆ¶Bé»æ“Šã€Œæ¥å—ã€é‚€è«‹
4. é›™æ–¹éƒ½æ¥å—å¾Œï¼š
   - è‡ªå‹•æˆç‚ºå¥½å‹
   - è‡¨æ™‚èŠå¤©å®¤å‡ç´šç‚ºæ°¸ä¹…èŠå¤©å®¤
   - èŠå¤©å®¤ä¸å†æœ‰éæœŸæ™‚é–“

### ç¬¬äº”æ­¥ï¼šæ¸¬è©¦å¥½å‹åŠŸèƒ½

**æŸ¥çœ‹å¥½å‹åˆ—è¡¨**:
1. é€²å…¥ã€Œå¥½å‹ã€é é¢
2. æ‡‰è©²çœ‹åˆ°å°æ–¹çš„å¸³è™Ÿ
3. é¡¯ç¤ºå¥½å‹çš„åœ¨ç·šç‹€æ…‹

**æŸ¥çœ‹å¥½å‹è£ç½®ç‹€æ…‹**:
1. é»æ“Šå¥½å‹é€²å…¥è©³æƒ…é é¢
2. å¯ä»¥çœ‹åˆ°å¥½å‹ç¶å®šçš„ESP32è£ç½®
3. é¡¯ç¤ºè£ç½®åœ¨ç·šç‹€æ…‹
4. é¡¯ç¤ºæœ€æ–°çš„å£“åŠ›æ•¸æ“šï¼ˆå¦‚æœè£ç½®åœ¨ç·šï¼‰

**æ°¸ä¹…èŠå¤©å®¤**:
1. é€²å…¥ã€ŒèŠå¤©å®¤ã€é é¢
2. çœ‹åˆ°èˆ‡å¥½å‹çš„æ°¸ä¹…èŠå¤©å®¤
3. èŠå¤©å®¤é¡å‹é¡¯ç¤ºç‚ºã€Œæ°¸ä¹…ã€
4. æ²’æœ‰éæœŸæ™‚é–“
5. å¯ä»¥éš¨æ™‚èŠå¤©

### ç¬¬å…­æ­¥ï¼šæ¸¬è©¦ESP32è£ç½®ï¼ˆå¯é¸ï¼‰

å¦‚æœæœ‰ESP32è£ç½®ï¼š

1. åœ¨å‰ç«¯ã€Œè£ç½®ã€é é¢é»æ“Šã€Œç¶å®šè£ç½®ã€
2. è¼¸å…¥ESP32çš„è£ç½®ID
3. ç¶å®šæˆåŠŸå¾Œå¯ä»¥çœ‹åˆ°ï¼š
   - è£ç½®åœ¨ç·šç‹€æ…‹
   - å¯¦æ™‚å£“åŠ›æ•¸æ“š
   - å£“åŠ›è®ŠåŒ–åœ–è¡¨ï¼ˆå¦‚æœå‰ç«¯æœ‰å¯¦ç¾ï¼‰

---

## ğŸ§ª å¿«é€Ÿæ¸¬è©¦è…³æœ¬ï¼ˆä½¿ç”¨APIï¼‰

å¦‚æœæƒ³ç›´æ¥æ¸¬è©¦APIï¼Œå¯ä»¥ä½¿ç”¨PowerShellï¼š

```powershell
# è¨­ç½®è®Šé‡
$API = "http://192.168.1.114:8000"

# 1. è¨»å†Šå…©å€‹ç”¨æˆ¶
$userA = Invoke-RestMethod "$API/api/auth/register" -Method POST -Body (@{email="test_a@example.com"; password="Test123!"} | ConvertTo-Json) -ContentType "application/json"
$userB = Invoke-RestMethod "$API/api/auth/register" -Method POST -Body (@{email="test_b@example.com"; password="Test123!"} | ConvertTo-Json) -ContentType "application/json"

# 2. ç²å–Token
$tokenA = (Invoke-RestMethod "$API/api/auth/token" -Method POST -Body "username=test_a@example.com&password=Test123!" -ContentType "application/x-www-form-urlencoded").access_token
$tokenB = (Invoke-RestMethod "$API/api/auth/token" -Method POST -Body "username=test_b@example.com&password=Test123!" -ContentType "application/x-www-form-urlencoded").access_token

Write-Host "âœ“ ç”¨æˆ¶å·²å‰µå»ºä¸¦ç™»å…¥" -ForegroundColor Green
Write-Host "Token A: $tokenA" -ForegroundColor Cyan
Write-Host "Token B: $tokenB" -ForegroundColor Cyan

# 3. éš¨æ©Ÿé…å°
Write-Host "`né–‹å§‹é…å°..." -ForegroundColor Yellow
$matchA = Invoke-RestMethod "$API/api/pairing/random-match" -Method POST -Headers @{Authorization="Bearer $tokenA"}
Write-Host "ç”¨æˆ¶A: $($matchA.message)" -ForegroundColor Cyan

Start-Sleep -Seconds 2

$matchB = Invoke-RestMethod "$API/api/pairing/random-match" -Method POST -Headers @{Authorization="Bearer $tokenB"}
Write-Host "ç”¨æˆ¶B: $($matchB.message)" -ForegroundColor Green

if ($matchB.matched) {
    Write-Host "âœ“ é…å°æˆåŠŸï¼èŠå¤©å®¤ID: $($matchB.chat_room_id)" -ForegroundColor Green
}

# 4. æŸ¥çœ‹èŠå¤©å®¤
Write-Host "`næŸ¥çœ‹èŠå¤©å®¤..." -ForegroundColor Yellow
$rooms = Invoke-RestMethod "$API/api/pairing/chat-rooms" -Headers @{Authorization="Bearer $tokenA"}
$rooms | ConvertTo-Json | Write-Host

Write-Host "`nç­‰å¾…30ç§’è®“èŠå¤©å®¤éæœŸ..." -ForegroundColor Yellow
Start-Sleep -Seconds 30

# 5. æª¢æŸ¥éæœŸ
$chatRoomId = $rooms[0].id
$expiry = Invoke-RestMethod "$API/api/pairing/chat-room/$chatRoomId/check-expiry" -Method POST -Headers @{Authorization="Bearer $tokenA"}
Write-Host "èŠå¤©å®¤éæœŸç‹€æ…‹: $($expiry | ConvertTo-Json)" -ForegroundColor Cyan

# 6. æŸ¥çœ‹é‚€è«‹
Write-Host "`næŸ¥çœ‹å¥½å‹é‚€è«‹..." -ForegroundColor Yellow
$invitations = Invoke-RestMethod "$API/api/pairing/invitations" -Headers @{Authorization="Bearer $tokenA"}
$invitations | ConvertTo-Json | Write-Host

# 7. é›™æ–¹æ¥å—é‚€è«‹
if ($invitations.Count -gt 0) {
    $invId = $invitations[0].id
    Write-Host "`næ¥å—å¥½å‹é‚€è«‹..." -ForegroundColor Yellow
    
    $acceptA = Invoke-RestMethod "$API/api/pairing/invitations/$invId/respond" -Method POST -Headers @{Authorization="Bearer $tokenA"} -Body (@{response="accept"} | ConvertTo-Json) -ContentType "application/json"
    Write-Host "ç”¨æˆ¶A: $($acceptA.message)" -ForegroundColor Cyan
    
    $acceptB = Invoke-RestMethod "$API/api/pairing/invitations/$invId/respond" -Method POST -Headers @{Authorization="Bearer $tokenB"} -Body (@{response="accept"} | ConvertTo-Json) -ContentType "application/json"
    Write-Host "ç”¨æˆ¶B: $($acceptB.message)" -ForegroundColor Green
    
    if ($acceptB.became_friends) {
        Write-Host "âœ“ æˆç‚ºå¥½å‹ï¼" -ForegroundColor Green
    }
}

# 8. æŸ¥çœ‹å¥½å‹åˆ—è¡¨
Write-Host "`næŸ¥çœ‹å¥½å‹åˆ—è¡¨..." -ForegroundColor Yellow
$friends = Invoke-RestMethod "$API/api/pairing/friends" -Headers @{Authorization="Bearer $tokenA"}
$friends | ConvertTo-Json | Write-Host

# 9. æŸ¥çœ‹å‡ç´šå¾Œçš„èŠå¤©å®¤
Write-Host "`næŸ¥çœ‹æ°¸ä¹…èŠå¤©å®¤..." -ForegroundColor Yellow
$permanentRooms = Invoke-RestMethod "$API/api/pairing/chat-rooms" -Headers @{Authorization="Bearer $tokenA"}
$permanentRooms | ConvertTo-Json | Write-Host

Write-Host "`nâœ“ æ‰€æœ‰æ¸¬è©¦å®Œæˆï¼" -ForegroundColor Green
```

---

## ğŸ” æª¢æŸ¥æœå‹™ç‹€æ…‹

### æª¢æŸ¥å¾Œç«¯æ˜¯å¦é‹è¡Œ
```powershell
curl http://192.168.1.114:8000/docs
# æ‡‰è©²çœ‹åˆ°APIæ–‡æª”é é¢
```

### æª¢æŸ¥å‰ç«¯æ˜¯å¦é‹è¡Œ
```powershell
curl http://localhost:8080
# æ‡‰è©²çœ‹åˆ°HTMLé é¢
```

### æŸ¥çœ‹å¾Œç«¯æ—¥èªŒ
å¾Œç«¯æ‡‰è©²åœ¨ä¸€å€‹PowerShellè¦–çª—ä¸­é‹è¡Œï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰APIè«‹æ±‚

### æŸ¥çœ‹å‰ç«¯æ—¥èªŒ
å‰ç«¯æ‡‰è©²åœ¨å¦ä¸€å€‹PowerShellè¦–çª—ä¸­é‹è¡Œï¼Œå¯ä»¥çœ‹åˆ°ç·¨è­¯å’Œç†±é‡è¼‰ä¿¡æ¯

---

## â“ å¸¸è¦‹å•é¡Œ

### Q1: å‰ç«¯ç„¡æ³•é€£æ¥åˆ°å¾Œç«¯
**è§£æ±ºæ–¹æ¡ˆ**: 
1. æª¢æŸ¥ `frontend/lib/config/app_config.dart`
2. ç¢ºèª API URL æ˜¯ `http://192.168.1.114:8000`
3. é‡æ–°å•Ÿå‹•å‰ç«¯

### Q2: é…å°æ²’æœ‰åæ‡‰
**è§£æ±ºæ–¹æ¡ˆ**:
1. ç¢ºèªå…©å€‹ç”¨æˆ¶éƒ½å·²ç™»å…¥
2. ç¢ºèªéƒ½åœ¨é…å°é é¢
3. æª¢æŸ¥å¾Œç«¯æ—¥èªŒæ˜¯å¦æœ‰éŒ¯èª¤

### Q3: èŠå¤©å®¤æ²’æœ‰éæœŸ
**è§£æ±ºæ–¹æ¡ˆ**:
1. æª¢æŸ¥ `backend/app/services/pairing_service.py` ç¬¬55è¡Œ
2. ç¢ºèªæ˜¯ `timedelta(seconds=30)` (æ¸¬è©¦æ¨¡å¼)
3. ç­‰å¾…å®Œæ•´çš„30ç§’

### Q4: å¥½å‹é‚€è«‹æ²’æœ‰å‡ºç¾
**è§£æ±ºæ–¹æ¡ˆ**:
1. æ‰‹å‹•æª¢æŸ¥éæœŸ: è¨ªå• `/api/pairing/chat-room/{id}/check-expiry`
2. åˆ·æ–°é é¢
3. é‡æ–°ç™»å…¥

---

## ğŸ“Š æ¸¬è©¦æª¢æŸ¥æ¸…å–®

- [ ] ç”¨æˆ¶Aè¨»å†ŠæˆåŠŸ
- [ ] ç”¨æˆ¶Bè¨»å†ŠæˆåŠŸ
- [ ] ç”¨æˆ¶Aå¯ä»¥ç™»å…¥
- [ ] ç”¨æˆ¶Bå¯ä»¥ç™»å…¥
- [ ] éš¨æ©Ÿé…å°æˆåŠŸ
- [ ] è‡¨æ™‚èŠå¤©å®¤å‰µå»º
- [ ] å¯ä»¥ç™¼é€è¨Šæ¯
- [ ] å€’æ•¸è¨ˆæ™‚å™¨é¡¯ç¤º
- [ ] 30ç§’å¾ŒèŠå¤©å®¤éæœŸ
- [ ] å¥½å‹é‚€è«‹å‡ºç¾
- [ ] ç”¨æˆ¶Aæ¥å—é‚€è«‹
- [ ] ç”¨æˆ¶Bæ¥å—é‚€è«‹
- [ ] æˆç‚ºå¥½å‹
- [ ] èŠå¤©å®¤å‡ç´šç‚ºæ°¸ä¹…
- [ ] å¥½å‹åˆ—è¡¨é¡¯ç¤º
- [ ] å¯ä»¥æŸ¥çœ‹å¥½å‹è£ç½®ï¼ˆå¦‚æœå·²ç¶å®šï¼‰

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **æ¸¬è©¦æ‰€æœ‰åŠŸèƒ½** - æŒ‰ç…§ä¸Šè¿°æµç¨‹å®Œæ•´æ¸¬è©¦ä¸€é
2. **ç¶å®šESP32è£ç½®** - å¦‚æœæœ‰å¯¦é«”è£ç½®ï¼Œæ¸¬è©¦è£ç½®ç¶å®šå’Œæ•¸æ“šä¸Šå‚³
3. **UIå„ªåŒ–** - æ ¹æ“šæ¸¬è©¦çµæœå„ªåŒ–ç”¨æˆ¶ç•Œé¢
4. **éŒ¯èª¤è™•ç†** - æ·»åŠ æ›´å¤šçš„éŒ¯èª¤æç¤ºå’Œè™•ç†

---

**ç¥æ¸¬è©¦é †åˆ©ï¼** ğŸ‰

å¦‚æœ‰ä»»ä½•å•é¡Œï¼Œè«‹æŸ¥çœ‹å¾Œç«¯å’Œå‰ç«¯çš„æ—¥èªŒè¼¸å‡ºã€‚
